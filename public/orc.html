<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>spatial orc controller</title>
  <style>
    body {
      background-color: #121212; /* Dark grey for background */
      color: #e0e0e0; /* Light grey for text */
      font-family: 'Courier New', Courier, monospace;
      margin: 20px;
    }
    h1, h2 {
      color: #ffffff; /* White for headers */
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    button {
      background-color: #333;
      color: #e0e0e0;
      border: 1px solid #555;
      padding: 8px 12px;
      margin: 5px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background-color: #444;
    }
    input[type="number"] {
      background-color: #222;
      color: #e0e0e0;
      border: 1px solid #555;
      padding: 8px;
      border-radius: 4px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background-color: #1f1f1f;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 4px;
      border: 1px solid #333;
    }
    #headerInfo {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #555;
    }
    #clientCountDisplay {
        font-size: 1em;
        font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="headerInfo">
    <h1>spatial orc controller</h1>
    <div id="clientCountDisplay">Connected SRCs: 0</div>
  </div>
  
  <div id="globalEffectsControls">
    <h2>Global Delay Settings</h2>
    <div>
      <label for="delayTime">Delay Time (0-2s):</label>
      <input type="number" id="delayTime" name="delayTime" min="0" max="2" step="0.05" value="0.4">
    </div>
    <div>
      <label for="delayFeedback">Feedback (0-0.9):</label>
      <input type="number" id="delayFeedback" name="delayFeedback" min="0" max="0.9" step="0.05" value="0.3">
    </div>
    <button id="applyGlobalDelay">Apply Global Delay</button>
  </div>
  
  <hr>
  <h2>Connected SRC Clients</h2>
  <ul id="clients"></ul>

  <script>
    const ws = new WebSocket(`ws://${location.host}`);
    const clientsList = document.getElementById('clients');
    // const clients = new Set(); // No longer strictly needed with current broadcast logic

    const notesToSend = ['A3', 'C4', 'E4', 'G4']; // Example notes (Cmin arpeggio)

    // Global Effects Controls
    const delayTimeInput = document.getElementById('delayTime');
    const delayFeedbackInput = document.getElementById('delayFeedback');
    const applyGlobalDelayButton = document.getElementById('applyGlobalDelay');

    applyGlobalDelayButton.onclick = () => {
      const delayTime = parseFloat(delayTimeInput.value);
      const feedback = parseFloat(delayFeedbackInput.value);
      console.log(`ORC: Applying global delay - Time: ${delayTime}, Feedback: ${feedback}`);
      ws.send(JSON.stringify({
        type: 'set_global_effect',
        effect: {
          type: 'delay',
          delayTime: delayTime,
          feedback: feedback
        }
      }));
    };

    ws.onopen = () => {
      ws.send(JSON.stringify({ type: 'register', id: 'orc' }));
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'clients') {
        clientsList.innerHTML = ''; // Clear the list
        let srcClientCount = 0;
        data.clients.forEach(clientId => {
          if (clientId !== 'orc') {
            srcClientCount++;
            const listItem = document.createElement('li');
            listItem.textContent = `${clientId}: `;

            notesToSend.forEach(note => {
              const noteButton = document.createElement('button');
              noteButton.textContent = note;
              noteButton.style.marginLeft = '5px';
              noteButton.onclick = () => {
                console.log(`ORC: Sending note '${note}' to ${clientId}`);
                ws.send(JSON.stringify({
                  type: 'message',
                  to: clientId,
                  payload: { type: 'note', note: note }
                }));
                console.log(`ORC: Message for '${note}' sent to ${clientId}`);
              };
              listItem.appendChild(noteButton);
            });
            clientsList.appendChild(listItem);
          }
        });
        document.getElementById('clientCountDisplay').textContent = `Connected SRCs: ${srcClientCount}`;
      }
    };
  </script>
</body>
</html>
